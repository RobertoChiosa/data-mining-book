<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data cleaning | Data mining methods for building energy data</title>
  <meta name="description" content="Chapter 2 Data cleaning | Data mining methods for building energy data" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data cleaning | Data mining methods for building energy data" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/logo-black.png" />
  
  <meta name="github-repo" content="https://github.com/RobertoChiosa/APPUNTI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data cleaning | Data mining methods for building energy data" />
  
  
  <meta name="twitter:image" content="images/logo-black.png" />



<meta name="date" content="2021-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="building-related-data.html"/>
<link rel="next" href="data-transformation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data mining methods for building energy data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Author</a></li>
<li class="chapter" data-level="1" data-path="building-related-data.html"><a href="building-related-data.html"><i class="fa fa-check"></i><b>1</b> Building related data</a><ul>
<li class="chapter" data-level="1.1" data-path="building-related-data.html"><a href="building-related-data.html#influencing-variables"><i class="fa fa-check"></i><b>1.1</b> influencing variables</a></li>
<li class="chapter" data-level="1.2" data-path="building-related-data.html"><a href="building-related-data.html#time-series"><i class="fa fa-check"></i><b>1.2</b> Time series</a></li>
<li class="chapter" data-level="1.3" data-path="building-related-data.html"><a href="building-related-data.html#visualizations"><i class="fa fa-check"></i><b>1.3</b> Visualizations</a><ul>
<li class="chapter" data-level="1.3.1" data-path="building-related-data.html"><a href="building-related-data.html#sec:boxplots"><i class="fa fa-check"></i><b>1.3.1</b> Box plots</a></li>
<li class="chapter" data-level="1.3.2" data-path="building-related-data.html"><a href="building-related-data.html#scatter-plots"><i class="fa fa-check"></i><b>1.3.2</b> scatter plots</a></li>
<li class="chapter" data-level="1.3.3" data-path="building-related-data.html"><a href="building-related-data.html#carpet-plots"><i class="fa fa-check"></i><b>1.3.3</b> carpet plots</a></li>
<li class="chapter" data-level="1.3.4" data-path="building-related-data.html"><a href="building-related-data.html#calendar-plots"><i class="fa fa-check"></i><b>1.3.4</b> calendar plots</a></li>
<li class="chapter" data-level="1.3.5" data-path="building-related-data.html"><a href="building-related-data.html#network"><i class="fa fa-check"></i><b>1.3.5</b> Network</a></li>
<li class="chapter" data-level="1.3.6" data-path="building-related-data.html"><a href="building-related-data.html#tree"><i class="fa fa-check"></i><b>1.3.6</b> tree</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>2</b> Data cleaning</a><ul>
<li class="chapter" data-level="2.1" data-path="data-cleaning.html"><a href="data-cleaning.html#inconsistences"><i class="fa fa-check"></i><b>2.1</b> Inconsistences</a></li>
<li class="chapter" data-level="2.2" data-path="data-cleaning.html"><a href="data-cleaning.html#outliers"><i class="fa fa-check"></i><b>2.2</b> Outliers</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-cleaning.html"><a href="data-cleaning.html#inter-quartile-method-for-punctual-outlier-identification"><i class="fa fa-check"></i><b>2.2.1</b> Inter-quartile method for punctual outlier identification</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-cleaning.html"><a href="data-cleaning.html#z-score-method-for-punctual-outlier-identification"><i class="fa fa-check"></i><b>2.2.2</b> Z-score method for punctual outlier identification</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-cleaning.html"><a href="data-cleaning.html#missing-values"><i class="fa fa-check"></i><b>2.3</b> Missing values</a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-cleaning.html"><a href="data-cleaning.html#global-constant-method"><i class="fa fa-check"></i><b>2.3.1</b> Global constant method</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-cleaning.html"><a href="data-cleaning.html#local-constant-method"><i class="fa fa-check"></i><b>2.3.2</b> Local constant method</a></li>
<li class="chapter" data-level="2.3.3" data-path="data-cleaning.html"><a href="data-cleaning.html#moving-average"><i class="fa fa-check"></i><b>2.3.3</b> Moving Average</a></li>
<li class="chapter" data-level="2.3.4" data-path="data-cleaning.html"><a href="data-cleaning.html#linear-interpolation-method"><i class="fa fa-check"></i><b>2.3.4</b> Linear interpolation method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> data transformation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-transformation.html"><a href="data-transformation.html#data-scaling"><i class="fa fa-check"></i><b>3.1</b> data scaling</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-transformation.html"><a href="data-transformation.html#max-scaling"><i class="fa fa-check"></i><b>3.1.1</b> Max scaling</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-transformation.html"><a href="data-transformation.html#min-max-scaling"><i class="fa fa-check"></i><b>3.1.2</b> Min Max scaling</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-transformation.html"><a href="data-transformation.html#normalization"><i class="fa fa-check"></i><b>3.1.3</b> normalization</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-transformation.html"><a href="data-transformation.html#data-type-transformation-aggregation"><i class="fa fa-check"></i><b>3.2</b> data type transformation aggregation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-transformation.html"><a href="data-transformation.html#equally-width-bins"><i class="fa fa-check"></i><b>3.2.1</b> equally width bins</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-transformation.html"><a href="data-transformation.html#equally-frequency-bins"><i class="fa fa-check"></i><b>3.2.2</b> equally frequency bins</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-transformation.html"><a href="data-transformation.html#integer-encoding"><i class="fa fa-check"></i><b>3.2.3</b> integer encoding</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-transformation.html"><a href="data-transformation.html#data-reduction"><i class="fa fa-check"></i><b>3.3</b> data reduction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-transformation.html"><a href="data-transformation.html#piecawise-aggregate-approximation-paa"><i class="fa fa-check"></i><b>3.3.1</b> Piecawise Aggregate Approximation (PAA)</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-transformation.html"><a href="data-transformation.html#data-segmentation"><i class="fa fa-check"></i><b>3.3.2</b> data segmentation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-transformation.html"><a href="data-transformation.html#visualization"><i class="fa fa-check"></i><b>3.4</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html"><i class="fa fa-check"></i><b>4</b> unsupervised learning</a><ul>
<li class="chapter" data-level="4.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#clustering"><i class="fa fa-check"></i><b>4.1</b> clustering</a><ul>
<li class="chapter" data-level="4.1.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#partitive"><i class="fa fa-check"></i><b>4.1.1</b> partitive</a></li>
<li class="chapter" data-level="4.1.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#hierarchical"><i class="fa fa-check"></i><b>4.1.2</b> hierarchical</a></li>
<li class="chapter" data-level="4.1.3" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#density"><i class="fa fa-check"></i><b>4.1.3</b> density</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#arm"><i class="fa fa-check"></i><b>4.2</b> ARM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>5</b> supervised learning</a><ul>
<li class="chapter" data-level="5.1" data-path="supervised-learning.html"><a href="supervised-learning.html#classification"><i class="fa fa-check"></i><b>5.1</b> classification</a></li>
<li class="chapter" data-level="5.2" data-path="supervised-learning.html"><a href="supervised-learning.html#regression"><i class="fa fa-check"></i><b>5.2</b> regression</a></li>
<li class="chapter" data-level="5.3" data-path="supervised-learning.html"><a href="supervised-learning.html#forecasting"><i class="fa fa-check"></i><b>5.3</b> forecasting</a></li>
<li class="chapter" data-level="5.4" data-path="supervised-learning.html"><a href="supervised-learning.html#benchmarking"><i class="fa fa-check"></i><b>5.4</b> benchmarking</a></li>
<li class="chapter" data-level="5.5" data-path="supervised-learning.html"><a href="supervised-learning.html#artificial-neural-network"><i class="fa fa-check"></i><b>5.5</b> artificial neural network</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data mining methods for building energy data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-cleaning" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Data cleaning</h1>
<p>Raw data are not always cleaned and ready for the analyst to be processed. Usually there are many anomalies that have to be fixed before the analytics process. Typical problems that can generate anomalies in the data:</p>
<ul>
<li>Meter communication failed;</li>
<li>Sensor break or modification;</li>
<li>Intervention on the system (e.g. revamping of the heating/cooling system);</li>
<li>Modification of the building usage;</li>
<li>Catastrophic events.</li>
</ul>
<p>Thus it is necessary to undergo a data preparation process that is usually the most time consuming task but also the most important. The process of “fixing” the data is called data cleaning and the main objective is to manage missing values, resolve inconsistencies, and detect and remove outliers.</p>
<p>It is a time consuming task that has to be performed through data driven and statistical methods as well as domain knowledge methods.</p>
<p>In the following, we will use as an example a portion of the dataset <code>df</code>. In particular we will consider just one week, shown in Figure <a href="data-cleaning.html#fig:scatter-week-raw">2.1</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:scatter-week-raw"></span>
<img src="bookdownproj_files/figure-html/scatter-week-raw-1.png" alt="Example of not cleaned dataset." width="672" />
<p class="caption">
Figure 2.1: Example of not cleaned dataset.
</p>
</div>
<div id="inconsistences" class="section level2">
<h2><span class="header-section-number">2.1</span> Inconsistences</h2>
<p>A first kind of inconsistence can be a duplicated data. A dataset may include duplicated data (ex. due to meter communication malfunctioning) and those observations have to be detected and removed. This process is defined as deduplication.</p>
<p>Another kind of inconsistence may be connected with the units of measure of the data. It is important to know the units of measure of physical qualtities in order to further manipulate the dataset and be consistent. A way to address to this issue is to convert data to known units of measure and possibly to the International System. R provides a package that convert the clsss to a units of measure.</p>
<p>Another type of inconsistence is defined by <span class="citation">Edwin and Mark (<a href="#ref-Paper2013" role="doc-biblioref">2013</a>)</span> as:</p>
<blockquote>
<p>A record that contains a value or combination of values that cannot correspond to a real-world situation.</p>
</blockquote>
<p>For example measures related to an electrical load cannot be negative infinite or not a real number, and any of those values can be easely detected and removed. In this case, a particular knowledge of the measured data and systems is necessary to correctly evaluate inconsistences, which are not absolute but can vary depending on the situation.</p>
<p>Such knowledge can be expressed as rules or constraints. In our case study since the measures value refers to electrical load (i.e. power absorbed by the utility) we know a priori that any negative value can be marked as inconsistence.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-cleaning.html#cb1-1"></a>inconsistences &lt;-<span class="st"> </span>df<span class="op">$</span>Total_Power[df<span class="op">$</span>Total_Power <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>]      <span class="co"># find inconsistent values</span></span>
<span id="cb1-2"><a href="data-cleaning.html#cb1-2"></a>inconsistences &lt;-<span class="st"> </span>inconsistences[<span class="op">!</span><span class="kw">is.na</span>(inconsistences)]  <span class="co"># removes NA from results</span></span></code></pre></div>
<p>The electrical load dataset contains 3 inconsistences (-100 kW, -110 kW, -100 kW). Once identified they can be removed by substituting NA value.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-cleaning.html#cb2-1"></a>index &lt;-<span class="st"> </span><span class="kw">which</span>(df<span class="op">$</span>Total_Power <span class="op">%in%</span><span class="st"> </span>inconsistences)     <span class="co"># row index of the inconsistence</span></span>
<span id="cb2-2"><a href="data-cleaning.html#cb2-2"></a>df<span class="op">$</span>Total_Power &lt;-<span class="st"> </span><span class="kw">replace</span>(df<span class="op">$</span>Total_Power, index, <span class="ot">NA</span>)   <span class="co"># replace with NA</span></span></code></pre></div>
</div>
<div id="outliers" class="section level2">
<h2><span class="header-section-number">2.2</span> Outliers</h2>
<p>A general definition of outlier is provided by <span class="citation">Capozzoli, Cerquitelli, and Piscitelli (<a href="#ref-Capozzoli2016" role="doc-biblioref">2016</a>)</span>:</p>
<blockquote>
<p>“Outliers are records that appear to deviate significantly from other elements in
the sample in which they occur. Outlier can be also defined as an observation (or subset of observations) that appears to be inconsistent with the remainder of that set of data.”</p>
</blockquote>
<p>In time series analysis, <span class="citation">Fan et al. (<a href="#ref-Fan2015" role="doc-biblioref">2015</a>)</span> defines the outliers as:</p>
<blockquote>
<p>"Observations unlikely to occur given the variance of the observations of the rest of the time series</p>
</blockquote>
<p>The so called outliers can be distinguished into:</p>
<ul>
<li>Punctual outliers</li>
<li>Sequence outliers.</li>
</ul>
<p>In the data pre-processing phase, the identification of punctual outliers is needed, whenever infrequent sequential patterns could be detected through further investigation at a later stage (non supervised methods).</p>
<div id="inter-quartile-method-for-punctual-outlier-identification" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Inter-quartile method for punctual outlier identification</h3>
<p>Detecting outliers with the interquartile method requires the calculation of three fundamental values:</p>
<ul>
<li>First quartile <span class="math inline">\(Q_1\)</span> : the point between the smallest value and the median (25% of the distribution) ;</li>
<li>Second quartile or median <span class="math inline">\(Q_2\)</span> : the middle value of the dataset (50% of the distribution);</li>
<li>Third quartile <span class="math inline">\(Q_3\)</span> : the point between median and the highest value (75% of the distribution);</li>
</ul>
<p>The difference between the third and the first quartile is called Inter-Quartile Range <span class="math inline">\(\text{IQR} = Q_3-Q_1\)</span>.</p>
<p>To detect the outliers is necessary to define an acceptability range and any data point lying outside this range are considered as outlier. The range is as given below:</p>
<p><span class="math display">\[\begin{equation}
R = [Q_2 − k \text{IQR}, Q_3 + k \text{IQR}]
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(k\)</span> is an arbitrary parameters usually set at <span class="math inline">\(1.5\)</span>. Depending on the analyst choice the value of <span class="math inline">\(k\)</span> can vary in order to enlarge or restrict the acceptability range, Any data point less than the Lower Bound or higher than the Upper Bound is considered as an <em>outlier</em>.</p>
<p>An effective way to visualize variables distributions and detect outliers is the boxplot (Section <a href="building-related-data.html#sec:boxplots">1.3.1</a>) because it summarizes in a single plot all the statistics needed. Those statistics can be easily calculated through the R package <code>stats</code> as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-cleaning.html#cb3-1"></a>Q1 =<span class="st"> </span><span class="kw">quantile</span>(df<span class="op">$</span>Total_Power, <span class="dt">na.rm =</span> T, <span class="kw">c</span>(<span class="fl">0.25</span>))  </span>
<span id="cb3-2"><a href="data-cleaning.html#cb3-2"></a>Q2 =<span class="st"> </span><span class="kw">quantile</span>(df<span class="op">$</span>Total_Power, <span class="dt">na.rm =</span> T, <span class="kw">c</span>(<span class="fl">0.50</span>))  </span>
<span id="cb3-3"><a href="data-cleaning.html#cb3-3"></a>Q3 =<span class="st"> </span><span class="kw">quantile</span>(df<span class="op">$</span>Total_Power, <span class="dt">na.rm =</span> T, <span class="kw">c</span>(<span class="fl">0.75</span>))  </span>
<span id="cb3-4"><a href="data-cleaning.html#cb3-4"></a>Iqr =<span class="st"> </span><span class="kw">IQR</span>(df<span class="op">$</span>Total_Power, <span class="dt">na.rm =</span> T)               </span>
<span id="cb3-5"><a href="data-cleaning.html#cb3-5"></a>k =<span class="st"> </span><span class="fl">1.5</span></span>
<span id="cb3-6"><a href="data-cleaning.html#cb3-6"></a>Lower_bound =<span class="st"> </span>Q1 <span class="op">-</span><span class="st"> </span>k<span class="op">*</span>Iqr</span>
<span id="cb3-7"><a href="data-cleaning.html#cb3-7"></a>Upper_bound =<span class="st"> </span>Q2 <span class="op">+</span><span class="st"> </span>k<span class="op">*</span>Iqr</span></code></pre></div>
<p>It is possible to identify the outliers by calculating the previous statistics and setting manually the range limits or by using the <code>boxplot.stats</code> function which, given the <span class="math inline">\(k\)</span> coefficient, returns a list of values in which and <code>$out</code> is a vector of all the detected outliers.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-cleaning.html#cb4-1"></a>outliers &lt;-<span class="st"> </span><span class="kw">boxplot.stats</span>(df<span class="op">$</span>Total_Power, <span class="dt">coef =</span> k)<span class="op">$</span>out</span></code></pre></div>
<p>The electrical load dataset contains 2 outliers (1933 kW, 1200 kW) red colored in <a href="data-cleaning.html#fig:scatter-week-raw">2.1</a>. Once identified they can be removed by substituting NA value.</p>
</div>
<div id="z-score-method-for-punctual-outlier-identification" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Z-score method for punctual outlier identification</h3>
<p>This process allows the outlier discovery through the use of Z-scores, which is a measure of the position of data and represents how many standard deviations it is far from the mean of a standard normal distribution <span class="math inline">\(N(0,1)\)</span>. If the value is positive, the value lies above the mean; if negative it lies below.</p>
<p>A given time series <span class="math inline">\(y(t) = \{y_1, \dots y_n\}\)</span> of length <span class="math inline">\(n\)</span> with mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span> is transformed into a new time series <span class="math inline">\(Z(t) = \{Z_1, \dots Z_n\}\)</span> of length <span class="math inline">\(n\)</span> with zero mean <span class="math inline">\(\mu = 0\)</span> and unitary standard deviation <span class="math inline">\(\sigma = 1\)</span> through the following equation:</p>
<p><span class="math display">\[\begin{equation}
Z(t) = \frac{y(t)-\mu}{\sigma}
\end{equation}\]</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-cleaning.html#cb5-1"></a>y &lt;-<span class="st"> </span>df<span class="op">$</span>Total_Power                         <span class="co"># original time series</span></span>
<span id="cb5-2"><a href="data-cleaning.html#cb5-2"></a>mu &lt;-<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>Total_Power, <span class="dt">na.rm =</span> T)       <span class="co"># mean</span></span>
<span id="cb5-3"><a href="data-cleaning.html#cb5-3"></a>sigma &lt;-<span class="st"> </span><span class="kw">sd</span>(df<span class="op">$</span>Total_Power_copy, <span class="dt">na.rm =</span> T) <span class="co"># standard deviation</span></span>
<span id="cb5-4"><a href="data-cleaning.html#cb5-4"></a>Z &lt;-<span class="st"> </span>(y<span class="op">-</span>mu)<span class="op">/</span>sigma                           <span class="co"># standardized time series</span></span></code></pre></div>
<p>Z-scores can quantify the unusualness of an observation when the data follow the normal distribution. The acceptability range for a Z-score normalized distribution is usually calculated with <span class="math inline">\(k = 2\)</span>.</p>
<p>This method is robust when the analyzed dataset follows the normal distrubution or distributions similar in shape (Figure <a href="data-cleaning.html#fig:zscore-normal">2.2</a> on the left). However, building energy data usually present a positively skewed distribution (Figure <a href="data-cleaning.html#fig:zscore-normal">2.2</a> on the right) and Z-score normalization for outlier detection can be applied ( detects the outliers 8.24, 4.55 corresponding to 1933 kW, 1200 kW ), but usually is avoided because in clear contrast with the underlying hypoteses of normality.</p>
<div class="figure"><span id="fig:zscore-normal"></span>
<img src="bookdownproj_files/figure-html/zscore-normal-1.png" alt="Example of Z-score normalization for a quasi-normal distribution (left) and building electrical load distribution (rigth). For each distribution is reported the histogram and the kernel density curve (light red) and the theoretical normal distribution (blue)" width="768" />
<p class="caption">
Figure 2.2: Example of Z-score normalization for a quasi-normal distribution (left) and building electrical load distribution (rigth). For each distribution is reported the histogram and the kernel density curve (light red) and the theoretical normal distribution (blue)
</p>
</div>
</div>
</div>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">2.3</span> Missing values</h2>
<p>A missing value consists in the lack of a given value or attribute in a dataset, the placeholder for missing value is NA.</p>
<p>There are several strategies to handle missing values, each of them has to be evaluated considering the circumstances.</p>
<p>The most obvious strategy is to eliminate or ignore missing values object during the analysis. Sometimes this approach is the only viable since the missing values covers some extensive part of the dataset; a reconstruction and estimation of those values could lead to data fabrication and lead to wrong or inconsistent model.</p>
<p>The other strategy consists in the estimation of the missing values. Common methods to handle missing values are global constant, local constant, moving average and interpolation.</p>
<p>A useful package that permits to handle missing values is <code>imputeTS</code>. Among many na-imputing functions it provides also <code>ggplot</code> functions to automatically inspect missing values (Figure <a href="data-cleaning.html#fig:imputeTS-plot">2.3</a>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-cleaning.html#cb6-1"></a><span class="kw">ggplot_na_distribution</span>(df<span class="op">$</span>Total_Power) <span class="op">+</span></span>
<span id="cb6-2"><a href="data-cleaning.html#cb6-2"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb6-3"><a href="data-cleaning.html#cb6-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;# observation (Time)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Electrical load [kW]&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:imputeTS-plot"></span>
<img src="bookdownproj_files/figure-html/imputeTS-plot-1.png" alt="Distribution of missing values plotted through imputeTS package. The time series missinv values are highlighted with the vertical red regions" width="768" />
<p class="caption">
Figure 2.3: Distribution of missing values plotted through imputeTS package. The time series missinv values are highlighted with the vertical red regions
</p>
</div>
<div id="global-constant-method" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Global constant method</h3>
<p>This method consists in substituting all the missing values in the data with a single value (e.g. Mean or Median value of the data or an arbitrary constant). The value has to be selected with an knowledge based on the current dataset. This method is the easiest one but usually the least effective, especially for building energy data.</p>
<p>In Figure <a href="data-cleaning.html#fig:global-constant-method">2.4</a> is presented an example of global constant imputation of the electrical load dataset with mean value (292.18 kW) and an arbitrary value (200 kW). To perform the missing value imputation we use the package <code>imputeTS</code> and its functions.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-cleaning.html#cb7-1"></a><span class="co"># global constant (mean) imputation </span></span>
<span id="cb7-2"><a href="data-cleaning.html#cb7-2"></a>imp &lt;-<span class="st"> </span><span class="kw">na_mean</span>(df<span class="op">$</span>Total_Power, <span class="dt">option =</span> <span class="st">&quot;mean&quot;</span>) </span>
<span id="cb7-3"><a href="data-cleaning.html#cb7-3"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot_na_imputations</span>(df<span class="op">$</span>Total_Power, imp) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb7-4"><a href="data-cleaning.html#cb7-4"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))   <span class="op">+</span><span class="st"> </span></span>
<span id="cb7-5"><a href="data-cleaning.html#cb7-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;Mean&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Electrical load [kW]&quot;</span>)</span>
<span id="cb7-6"><a href="data-cleaning.html#cb7-6"></a></span>
<span id="cb7-7"><a href="data-cleaning.html#cb7-7"></a><span class="co"># global constant (arbitrary) imputation</span></span>
<span id="cb7-8"><a href="data-cleaning.html#cb7-8"></a>imp &lt;-<span class="st"> </span><span class="kw">na_replace</span>(df<span class="op">$</span>Total_Power, <span class="dt">fill =</span> <span class="dv">200</span> )      </span>
<span id="cb7-9"><a href="data-cleaning.html#cb7-9"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot_na_imputations</span>(df<span class="op">$</span>Total_Power, imp) <span class="op">+</span><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb7-10"><a href="data-cleaning.html#cb7-10"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))   <span class="op">+</span><span class="st"> </span></span>
<span id="cb7-11"><a href="data-cleaning.html#cb7-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;Constant&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb7-12"><a href="data-cleaning.html#cb7-12"></a></span>
<span id="cb7-13"><a href="data-cleaning.html#cb7-13"></a><span class="kw">ggarrange</span>(p1, p2, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span id="fig:global-constant-method"></span>
<img src="bookdownproj_files/figure-html/global-constant-method-1.png" alt="Global constant method imputation applied on the electrical load dataset. In blue the known values and in red the missing values replacement" width="768" />
<p class="caption">
Figure 2.4: Global constant method imputation applied on the electrical load dataset. In blue the known values and in red the missing values replacement
</p>
</div>
</div>
<div id="local-constant-method" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Local constant method</h3>
<p>the mean is calculated in some intervals for example day of the week. Local mean, lookaup tables
substitute the missing values in the data with a values calculated locally. This process is carried out through Lookup Tables.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-cleaning.html#cb8-1"></a><span class="kw">data.frame</span>(<span class="dt">Day =</span> <span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>), <span class="dt">Mean =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="data-cleaning.html#cb8-2"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">caption =</span> <span class="st">&quot;Raw gapminder data for Australia.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-10">Table 2.1: </span>Raw gapminder data for Australia.</caption>
<thead>
<tr class="header">
<th align="left">Day</th>
<th align="right">Mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mon</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Tue</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="moving-average" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Moving Average</h3>
<p>Method based on moving averages consist in substitute missing values with an expression computed on the N previous valid measures. There are different kind of mooving averages: Simple, Linear Weighted, Exponential. In this case the simple moving average (SMA) is considered.</p>
<p>In this particular case the SMA is defined as follows:
<span class="math display">\[
\begin{equation}
y = \frac{1}{N}\sum_{i=1}^n{y_{-i}}
\end{equation}
\]</span></p>
<p>Where <span class="math inline">\(n\)</span> is chosen by the analyst. For building energy data it usually renges from from 4 to 10.</p>
<p>In Figure <a href="data-cleaning.html#fig:SMA-method">2.5</a> is presented an example of imputation of the electrical load dataset with simple moving average with <span class="math inline">\(n = 4\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-cleaning.html#cb9-1"></a>imp &lt;-<span class="st"> </span><span class="kw">na_ma</span>(df<span class="op">$</span>Total_Power, <span class="dt">k =</span> <span class="dv">4</span>)</span>
<span id="cb9-2"><a href="data-cleaning.html#cb9-2"></a></span>
<span id="cb9-3"><a href="data-cleaning.html#cb9-3"></a><span class="kw">ggplot_na_imputations</span>(df<span class="op">$</span>Total_Power, imp) <span class="op">+</span><span class="st">  </span></span>
<span id="cb9-4"><a href="data-cleaning.html#cb9-4"></a><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-5"><a href="data-cleaning.html#cb9-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Electrical load [kW]&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:SMA-method"></span>
<img src="bookdownproj_files/figure-html/SMA-method-1.png" alt="Simple mooving average method applied on the electrical load dataset. In blue the known values and in red the missing values replacement" width="768" />
<p class="caption">
Figure 2.5: Simple mooving average method applied on the electrical load dataset. In blue the known values and in red the missing values replacement
</p>
</div>
</div>
<div id="linear-interpolation-method" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Linear interpolation method</h3>
<p>Another method for missing values replacement is the interpolation. There are different types of interpolation: linear, spline or polynomial. In this framework only linear interpolation is considered since it is the most common, simple and provides results similar to more complex interpolation methods.</p>
<p>Linear interpolation substitute missing values with the values that lies on the straight line between two valid measures. Given two points <span class="math inline">\(P_i = (x_i,y_i)\)</span> and <span class="math inline">\(P_{i+1} = (x_{i+1},y_{i+1})\)</span> the equation of the line can be obtained as follows:</p>
<p>Lets say that the last value [(x0,y0),(x1,y1)].</p>
<p><span class="math display">\[
\begin{equation}
\frac{y_-y_i}{y_{i+1}-y_i}  = \frac{x-x_i}{x_{i+1}-x_i}
\end{equation}
\]</span></p>
<p>In Figure <a href="data-cleaning.html#fig:interpolation-method">2.6</a> is presented an example of imputation of the electrical load dataset with simple linear interpolation.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-cleaning.html#cb10-1"></a>imp &lt;-<span class="st"> </span><span class="kw">na_interpolation</span>(df<span class="op">$</span>Total_Power)</span>
<span id="cb10-2"><a href="data-cleaning.html#cb10-2"></a><span class="kw">ggplot_na_imputations</span>(df<span class="op">$</span>Total_Power, imp) <span class="op">+</span><span class="st">  </span></span>
<span id="cb10-3"><a href="data-cleaning.html#cb10-3"></a><span class="st">   </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-4"><a href="data-cleaning.html#cb10-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Electrical load [kW]&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:interpolation-method"></span>
<img src="bookdownproj_files/figure-html/interpolation-method-1.png" alt="Interpolation method applied on the electrical load dataset. In blue the known values and in red the missing values replacement" width="768" />
<p class="caption">
Figure 2.6: Interpolation method applied on the electrical load dataset. In blue the known values and in red the missing values replacement
</p>
</div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Capozzoli2016">
<p>Capozzoli, Alfonso, T. Cerquitelli, and Marco Savino Piscitelli. 2016. <em>Enhancing energy efficiency in buildings through innovative data analytics technologies</em>. <a href="https://doi.org/10.1016/B978-0-12-803663-1.00011-5">https://doi.org/10.1016/B978-0-12-803663-1.00011-5</a>.</p>
</div>
<div id="ref-Paper2013">
<p>Edwin, De Jonge, and Van der Loo Mark. 2013. “An introduction to data cleaning with R the policies of Statistics Netherlands.”</p>
</div>
<div id="ref-Fan2015">
<p>Fan, Cheng, Fu Xiao, Henrik Madsen, and Dan Wang. 2015. “Temporal knowledge discovery in big BAS data for building energy management.” <em>Energy and Buildings</em> 109: 75–89. <a href="https://doi.org/10.1016/j.enbuild.2015.09.060">https://doi.org/10.1016/j.enbuild.2015.09.060</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="building-related-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-transformation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RobertoChiosa/APPUNTI/master/02_Data_cleaning.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RobertoChiosa/APPUNTI/blob/master/02_Data_cleaning.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"download": ["pdf", "epub"]
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
